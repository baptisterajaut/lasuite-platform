{{- $_ := .Values.secretSeed | required "secretSeed is required" }}
{{- $appNamespaces := list }}
{{- if .Values.apps.docs.enabled }}{{- $appNamespaces = append $appNamespaces "lasuite-docs" }}{{- end }}
{{- if .Values.apps.meet.enabled }}{{- $appNamespaces = append $appNamespaces "lasuite-meet" }}{{- end }}
{{- if .Values.apps.drive.enabled }}{{- $appNamespaces = append $appNamespaces "lasuite-drive" }}{{- end }}
{{- if .Values.apps.desk.enabled }}{{- $appNamespaces = append $appNamespaces "lasuite-desk" }}{{- end }}
{{- if .Values.apps.conversations.enabled }}{{- $appNamespaces = append $appNamespaces "lasuite-conversations" }}{{- end }}
{{- $namespaces := join "," $appNamespaces }}
---
# PostgreSQL admin credentials (for creating app databases)
apiVersion: v1
kind: Secret
metadata:
  name: postgresql-admin
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "platform-configuration.labels" . | nindent 4 }}
type: Opaque
stringData:
  postgres-password: "{{ include "getSecret" (dict "root" . "id" "postgres-admin") }}"
  password: "{{ include "getSecret" (dict "root" . "id" "postgres") }}"
---
# PostgreSQL app user credentials (replicated to app namespaces)
apiVersion: v1
kind: Secret
metadata:
  name: postgresql-credentials
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "platform-configuration.labels" . | nindent 4 }}
  {{- if $namespaces }}
  annotations:
    {{- include "reflector.annotations" $namespaces | nindent 4 }}
  {{- end }}
type: Opaque
stringData:
  host: "{{ .Values.postgres.host }}"
  port: "{{ .Values.postgres.port }}"
  username: "lasuite"
  password: "{{ include "getSecret" (dict "root" . "id" "postgres") }}"
